# HTTP首部

## End-to-end首部和Hop-by-hop首部

HTTP首部字段将定义成**缓存代理**和**非缓存代理**的行为，分成2种类型。

- 端到端首部（End-to-end Header）

  此类首部会转发给请求/响应对应的最终接受目标，且必须保存在由缓存生成的响应中，另外规定它必须被转发。

- 逐跳首部（Hop-by-hop Header）

  此类首部只对单次转发有效，会因通过缓存或代理而不再转发。HTTP/1.1 之后的版本中，如果需要使用此类首部，需要提供Connection首部字段。

> HTTP/1.1中的8种逐跳首部字段，除了这8种，均为端到端

- Connection
- Keep-Alive
- Proxy-Authenticate
- Proxy-Authorization
- Trailer
- TE
- Transfer-Encoding
- Upgrade

## 通用首部字段

### Cache-Control

常见的取值有：private、public、no-cache、no-store、 max-age，**默认为private**

- private:                                  客户端可以缓存
- public:                                   客户端和代理服务器都可缓存(前端的同学,可以认为public和private是
  一样的)
- max-age=xxx:                      缓存的内容将在 xxx 秒后失效
- no-cache:                             需要使用对比缓存来验证缓存数据(后面介绍)
- no-store:                               所有内容都不会缓存,强制缓存,对比缓存都不会触发(对于前端开发来说,缓存越多越好,so...基本上和它说886)

举个板栗

![](/home/yeoman/文档/archieves/image/2018-12-15_20-53.png)

图中Cache-Control仅指定了max-age,所以默认为private,缓存时间为31536000秒
(365天)
也就是说,在365天内再次请求这条数据,都会直接获取缓存数据库中的数据,直接使用。



#### 对比缓存
对比缓存,顾名思义,需要进行比较判断是否可以使用缓存。
浏览器第一次请求数据时,服务器会将缓存标识与数据一起返回给客户端,客户
端将二者备份至缓存数据库中。
再次请求数据时,客户端将备份的缓存标识发送给服务器,服务器根据缓存标识
进行判断,判断成功后,返回304状态码,通知客户端比较成功,可以使用缓存
数据。

第一次访问：

![](/home/yeoman/文档/archieves/image/2018-12-15_20-54.png)

再次访问：

![](/home/yeoman/文档/archieves/image/2018-12-15_20-55.png)

通过两图的对比,我们可以很清楚的发现,在对比缓存生效时,状态码为304,
并且报文大小和请求时间大大减少。

原因是,服务端在进行标识比较后,只返回header部分,通过状态码通知客户端使用缓存,不再需要将报文主体部分返回给客户端。

对于对比缓存来说,缓存标识的传递是我们着重需要理解的,它在请求header和响应header间进行传递。

一共分为两种标识传递,接下来,会在**请求、回应首部**中介绍。



#### no-cache

使用 no-cache 指令的目的是为了防止从缓存中返回过期的资源。

- 客户端发送no-cache

  客户端发送的请求中如果包含 no-cache 指令,则表示客户端将不会接

  收缓存过的响应。于是,“中间”的缓存服务器必须把客户端请求转发
  给源服务器。

- 服务器发送no-cache

  如果服务器返回的响应中包含 no-cache 指令,那么缓存服务器不能对
  资源进行缓存。源服务器以后也将不再对缓存服务器请求中提出的资
  源有效性进行确认,且禁止其对响应资源进行缓存操作。

#### no-store

所有内容都不会缓存,强制缓存,对比缓存都不会触发(对于前端开发来说,缓存越多越好,so...基本上和它说886)



> no-cache和no-store区别

从字面意思上很容易把 no-cache 误解成为不缓存,但事实上 no-cache 代表不缓
存过期的资源,缓存会向源服务器进行有效期确认后处理资源,也许称为 do-not-
serve-from-cache-without-revalidation 更合适。no-store 才是真正地不进行缓存。

